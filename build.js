(()=>{var e={453:(e,t,i)=>{const s=i(95);function r(){this.map=(new THREE.TextureLoader).load("assets/images/"+s.meta.image)}r.prototype={getUVConverters:function(e){return e?(e=e.replace("brushes/",""),{convertU:function(t){var i=s.meta.size,r=s.frames[e];return(t>1||t<0)&&(t=0),r.frame.x/i.w+t*r.frame.w/i.w},convertV:function(t){var i=s.meta.size,r=s.frames[e];return(t>1||t<0)&&(t=0),1-(r.frame.y/i.h+t*r.frame.h/i.h)}}):{convertU:function(e){return e},convertV:function(e){return e}}}},window.atlas=new r},967:()=>{window.BinaryManager=function(e){this.dataview=new DataView(e),this.offset=0,this.isLittleEndian=!0},window.BinaryManager.prototype={readQuaternion:function(){return new THREE.Quaternion(this.readFloat(),this.readFloat(),this.readFloat(),this.readFloat())},readVector3:function(){return new THREE.Vector3(this.readFloat(),this.readFloat(),this.readFloat())},readString:function(){for(var e=this.dataview.getUint8(this.offset++,!0),t="",i=0;i<e;i++)t+=String.fromCharCode(this.dataview.getUint8(this.offset++,!0));return t},readColor:function(){return new THREE.Color(this.readFloat(),this.readFloat(),this.readFloat())},readFloat:function(){var e=this.dataview.getFloat32(this.offset,!0);return this.offset+=4,e},readUint32:function(){var e=this.dataview.getUint32(this.offset,!0);return this.offset+=4,e},readUint16:function(){var e=this.dataview.getUint16(this.offset,!0);return this.offset+=2,e},readUint8:function(){var e=this.dataview.getUint8(this.offset,!0);return this.offset++,e},writeVector:function(e){this.writeFloat32Array(e.toArray())},writeColor:function(e){this.writeFloat32Array(e.toArray())},writeString:function(e){this.writeUint8(e.length);for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t))},writeUint8:function(e){this.dataview.setUint8(this.offset,e,this.isLittleEndian),this.offset++},writeUint16:function(e){this.dataview.setUint16(this.offset,e,this.isLittleEndian),this.offset+=2},writeUint32:function(e){this.dataview.setUint32(this.offset,e,this.isLittleEndian),this.offset+=4},writeFloat32:function(e){this.dataview.setFloat32(this.offset,e,this.isLittleEndian),this.offset+=4},writeFloat32Array:function(e){for(var t=0;t<e.length;t++)this.writeFloat32(e[t])},getDataView:function(){return this.dataview}}},830:()=>{AFRAME.registerBrush("cubes",{init:function(e,t){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,shading:THREE.FlatShading}),this.geometry=new THREE.BoxGeometry(1,1,1)},addPoint:function(e,t,i,s,r){var n=new THREE.Mesh(this.geometry,this.material),a=s*this.data.size*Math.random();return n.scale.set(a,a,a),n.position.copy(i),n.rotation.copy(t),this.object3D.add(n),!0}},{thumbnail:"brushes/thumb_cubes.gif",spacing:.01})},295:(e,t,i)=>{var s=i(297),r=i(51);!function(){r((function(){var e={vertexColors:THREE.VertexColors,side:THREE.DoubleSide},t={roughness:.75,metalness:.25,vertexColors:THREE.VertexColors,map:window.atlas.map,side:THREE.DoubleSide},i={roughness:.75,metalness:.25,vertexColors:THREE.VertexColors,side:THREE.DoubleSide,map:window.atlas.map,transparent:!0,alphaTest:.5};s.addSharedBuffer("strip-flat",new THREE.MeshBasicMaterial(e)),s.addSharedBuffer("strip-shaded",new THREE.MeshStandardMaterial(t)),s.addSharedBuffer("strip-textured",new THREE.MeshStandardMaterial(i))}));for(var e,t,i,n,a,o,h={init:function(e,t){this.sharedBuffer=s.getSharedBuffer("strip-"+this.materialOptions.type),this.sharedBuffer.restartPrimitive(),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.first=!0},remove:function(){this.sharedBuffer.remove(this.prevIdx,this.idx)},undo:function(){this.sharedBuffer.undo(this.prevIdx)},addPoint:(o=new THREE.Vector3,function(e,t,i,s,r){var n=this.materialOptions.converter;o.set(1,0,0),o.applyQuaternion(t),o.normalize();var a=i.clone(),h=i.clone(),u=this.data.size*s;if(a.add(o.clone().multiplyScalar(u/2)),h.add(o.clone().multiplyScalar(-u/2)),this.first&&this.prevIdx.position>0&&(this.first=!1,this.sharedBuffer.addVertex(a.x,a.y,a.z),this.sharedBuffer.idx.normal++,this.sharedBuffer.idx.color++,this.sharedBuffer.idx.uv++,this.idx=Object.assign({},this.sharedBuffer.idx)),this.sharedBuffer.addVertex(a.x,a.y,a.z),this.sharedBuffer.addVertex(h.x,h.y,h.z),this.sharedBuffer.idx.normal+=2,this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b),this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b),"textured"===this.materialOptions.type){this.sharedBuffer.idx.uv+=2;for(var c,l,d=this.sharedBuffer.current.attributes.uv.array,m=0;m<this.data.numPoints+1;m++)c=m/this.data.numPoints,l=4*m,0!==this.prevIdx.uv&&(l+=2*(this.prevIdx.uv+1)),d[l]=n.convertU(c),d[l+1]=n.convertV(0),d[l+2]=n.convertU(c),d[l+3]=n.convertV(1)}return this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.update(),this.computeVertexNormals(),!0}),computeVertexNormals:(e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3,function(){for(var s=0===this.prevIdx.position?0:3*(this.prevIdx.position+1),r=3*this.idx.position,o=this.sharedBuffer.current.attributes.position.array,h=this.sharedBuffer.current.attributes.normal.array,u=s;u<=r;u++)h[u]=0;var c=!0;for(u=s;u<r-6;u+=3)c?(e.fromArray(o,u),t.fromArray(o,u+3),i.fromArray(o,u+6)):(t.fromArray(o,u),i.fromArray(o,u+6),e.fromArray(o,u+3)),c=!c,n.subVectors(i,t),a.subVectors(e,t),n.cross(a),n.normalize(),h[u]+=n.x,h[u+1]+=n.y,h[u+2]+=n.z,h[u+3]+=n.x,h[u+4]+=n.y,h[u+5]+=n.z,h[u+6]+=n.x,h[u+7]+=n.y,h[u+8]+=n.z;for(u=s+6;u<r-6;u++)h[u]=h[u]/3;h[s+3]=h[s+3]/2,h[s+3+1]=h[s+3+1]/2,h[s+3+2]=h[s+3+2]/2,h[r-6]=h[r-6]/2,h[r-6+1]=h[r-6+1]/2,h[r-6+2]=h[r-6+2]/2})},u=[{name:"flat",materialOptions:{type:"flat"},thumbnail:"brushes/thumb_flat.gif"},{name:"smooth",materialOptions:{type:"shaded"},thumbnail:"brushes/thumb_smooth.gif"},{name:"squared-textured",materialOptions:{type:"textured",textureSrc:"brushes/squared_textured.png"},thumbnail:"brushes/thumb_squared_textured.gif"},{name:"line-gradient",materialOptions:{type:"textured",textureSrc:"brushes/line_gradient.png"},thumbnail:"brushes/thumb_line_gradient.gif"},{name:"silky-flat",materialOptions:{type:"textured",textureSrc:"brushes/silky_flat.png"},thumbnail:"brushes/thumb_silky_flat.gif"},{name:"silky-textured",materialOptions:{type:"textured",textureSrc:"brushes/silky_textured.png"},thumbnail:"brushes/thumb_silky_textured.gif"},{name:"lines1",materialOptions:{type:"textured",textureSrc:"brushes/lines1.png"},thumbnail:"brushes/thumb_lines1.gif"},{name:"lines2",materialOptions:{type:"textured",textureSrc:"brushes/lines2.png"},thumbnail:"brushes/thumb_lines2.gif"},{name:"lines3",materialOptions:{type:"textured",textureSrc:"brushes/lines3.png"},thumbnail:"brushes/thumb_lines3.gif"},{name:"lines4",materialOptions:{type:"textured",textureSrc:"brushes/lines4.png"},thumbnail:"brushes/thumb_lines4.gif"},{name:"lines5",materialOptions:{type:"textured",textureSrc:"brushes/lines5.png"},thumbnail:"brushes/thumb_lines5.gif"},{name:"line-grunge1",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge1.png"},thumbnail:"brushes/thumb_line_grunge1.gif"},{name:"line-grunge2",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge2.png"},thumbnail:"brushes/thumb_line_grunge2.gif"},{name:"line-grunge3",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge3.png"},thumbnail:"brushes/thumb_line_grunge3.gif"}],c=0;c<u.length;c++){var l=u[c];l.materialOptions.textureSrc?l.materialOptions.converter=window.atlas.getUVConverters(l.materialOptions.textureSrc):l.materialOptions.converter=window.atlas.getUVConverters(null),AFRAME.registerBrush(l.name,Object.assign({},h,{materialOptions:l.materialOptions}),{thumbnail:l.thumbnail,maxPoints:3e3})}}()},775:()=>{var e,t,s,r,n;n=new THREE.ShaderMaterial({vertexShader:"varying vec2 vUv;     void main() {       vUv = uv;       gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );     }",fragmentShader:"uniform sampler2D tDiffuse;     uniform float amount;     uniform float time;     varying vec2 vUv;         vec3 hsv2rgb(vec3 c) {         vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);         vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);         return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);     }         void main() {       float h = mod(vUv.x - time / 3000.0, 1.0);       vec4 color = vec4(hsv2rgb(vec3(h, 1.0, 0.5)), 1.0);       gl_FragColor = color;     }",side:THREE.DoubleSide,uniforms:{time:{type:"f",value:0}}}),AFRAME.registerBrush("line-rainbow",{init:function(e,t){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3),this.uvs=new Float32Array(2*this.options.maxPoints*2),this.linepositions=new Float32Array(this.options.maxPoints),this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("lineposition",new THREE.BufferAttribute(this.linepositions,1).setDynamic(!0)),this.material=n;var i=new THREE.Mesh(this.geometry,this.material);i.frustumCulled=!1,i.vertices=this.vertices,this.object3D.add(i)},addPoint:(e=new THREE.Vector3,t=new THREE.Vector3,s=new THREE.Vector3,r=new THREE.Vector3,function(n,a,o,h,u){var c=0;for(i=0;i<this.data.numPoints;i++)this.uvs[c++]=i/(this.data.numPoints-1),this.uvs[c++]=0,this.uvs[c++]=i/(this.data.numPoints-1),this.uvs[c++]=1;e.set(1,0,0),e.applyQuaternion(a),e.normalize(),t.copy(o),s.copy(o);var l=this.data.size*h;return t.add(r.copy(e).multiplyScalar(l/2)),s.add(r.copy(e).multiplyScalar(-l/2)),this.vertices[this.idx++]=t.x,this.vertices[this.idx++]=t.y,this.vertices[this.idx++]=t.z,this.vertices[this.idx++]=s.x,this.vertices[this.idx++]=s.y,this.vertices[this.idx++]=s.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,2*this.data.numPoints),!0}),tick:function(e,t){this.material.uniforms.time.value=e}},{thumbnail:"brushes/thumb_rainbow.png",maxPoints:3e3})},891:()=>{AFRAME.registerBrush("single-sphere",{init:function(e,t){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.6,metalness:.2,side:THREE.FrontSide,shading:THREE.SmoothShading}),this.geometry=new THREE.IcosahedronGeometry(1,2),this.mesh=new THREE.Mesh(this.geometry,this.material),this.object3D.add(this.mesh),this.mesh.visible=!1},addPoint:function(e,t,i,s,r){this.firstPoint||(this.firstPoint=i.clone(),this.mesh.position.set(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z)),this.mesh.visible=!0;var n=this.firstPoint.distanceTo(i);return this.mesh.scale.set(n,n,n),!0}},{thumbnail:"brushes/thumb_single_sphere.png",spacing:0})},988:()=>{AFRAME.registerBrush("spheres",{init:function(e,t){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,shading:THREE.FlatShading}),this.geometry=new THREE.IcosahedronGeometry(1,0)},addPoint:function(e,t,i,s,r){var n=new THREE.Mesh(this.geometry,this.material),a=this.data.size/2*s;return n.scale.set(a,a,a),n.initialScale=n.scale.clone(),n.phase=Math.random()*Math.PI*2,n.position.copy(i),n.rotation.copy(t),this.object3D.add(n),!0},tick:function(e,t){for(var i=0;i<this.object3D.children.length;i++){var s=this.object3D.children[i],r=(Math.sin(s.phase+e/500)+1)/2+.1;s.scale.copy(s.initialScale).multiplyScalar(r)}}},{thumbnail:"brushes/thumb_spheres.gif",spacing:.01})},623:(e,t,i)=>{var s=i(297),r=i(51);!function(){r((function(){var e=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,map:window.atlas.map,vertexColors:THREE.VertexColors,transparent:!0,alphaTest:.5,roughness:.75,metalness:.25}),t=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:window.atlas.map,vertexColors:THREE.VertexColors,transparent:!0,alphaTest:.5});s.addSharedBuffer("tris-flat",t),s.addSharedBuffer("tris-shaded",e)}));for(var e,t,i,n,a,o,h,u,c={init:function(e,t){this.sharedBuffer=s.getSharedBuffer("tris-"+this.materialOptions.type),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.currAngle=0,this.subTextures=1,this.angleJitter=0,this.autoRotate=!1,void 0!==this.materialOptions.subTextures&&(this.subTextures=this.materialOptions.subTextures),!0===this.materialOptions.autoRotate&&(this.autoRotate=!0),void 0!==this.materialOptions.angleJitter&&(this.angleJitter=this.materialOptions.angleJitter,this.angleJitter=2*this.angleJitter-this.angleJitter)},remove:function(){this.sharedBuffer.remove(this.prevIdx,this.idx)},undo:function(){this.sharedBuffer.undo(this.prevIdx)},addPoint:(e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,h=new THREE.Vector3,u=Math.PI/2,function(s,r,c,l,d){t.set(1,0,0),t.applyQuaternion(r),t.normalize(),e.set(0,1,0),e.applyQuaternion(r),e.normalize();var m=this.data.size*l/2,p=Math.PI/4+Math.random()*this.angleJitter;this.autoRotate&&(this.currAngle+=.1,p+=this.currAngle),i.copy(c).add(h.copy(t.applyAxisAngle(e,p)).multiplyScalar(m)),n.copy(c).add(h.copy(t.applyAxisAngle(e,u)).multiplyScalar(m)),a.copy(c).add(h.copy(t.applyAxisAngle(e,u)).multiplyScalar(m)),o.copy(c).add(t.applyAxisAngle(e,u).multiplyScalar(m)),this.idx.position,this.idx.position,this.sharedBuffer.addVertex(i.x,i.y,i.z),this.sharedBuffer.addVertex(n.x,n.y,n.z),this.sharedBuffer.addVertex(a.x,a.y,a.z),this.sharedBuffer.addVertex(a.x,a.y,a.z),this.sharedBuffer.addVertex(o.x,o.y,o.z),this.sharedBuffer.addVertex(i.x,i.y,i.z);for(var f=0;f<6;f++)this.sharedBuffer.addNormal(e.x,e.y,e.z),this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b);this.data.numPoints;var g=0,b=1;if(this.subTextures>1){var v=Math.floor(Math.random()*this.subTextures);b=(g=1/this.subTextures*v)+1/this.subTextures}var E=this.materialOptions.converter;return this.sharedBuffer.addUV(E.convertU(g),E.convertV(1)),this.sharedBuffer.addUV(E.convertU(g),E.convertV(0)),this.sharedBuffer.addUV(E.convertU(b),E.convertV(0)),this.sharedBuffer.addUV(E.convertU(b),E.convertV(0)),this.sharedBuffer.addUV(E.convertU(b),E.convertV(1)),this.sharedBuffer.addUV(E.convertU(g),E.convertV(1)),this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.update(),!0})},l=[{name:"dots",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_dots.png"},thumbnail:"brushes/thumb_stamp_dots.gif",spacing:.01},{name:"squares",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_squares.png"},thumbnail:"brushes/thumb_stamp_squares.gif",spacing:.01},{name:"column",materialOptions:{type:"shaded",autoRotate:!0,textureSrc:"brushes/stamp_column.png"},thumbnail:"brushes/thumb_stamp_column.gif",spacing:.01},{name:"gear1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,subTextures:2,textureSrc:"brushes/stamp_gear.png"},thumbnail:"brushes/thumb_stamp_gear.gif",spacing:.05},{name:"grunge1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge1.png"},thumbnail:"brushes/stamp_grunge1.png",spacing:.02},{name:"grunge2",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge2.png"},thumbnail:"brushes/stamp_grunge2.png",spacing:.02},{name:"grunge3",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge3.png"},thumbnail:"brushes/stamp_grunge3.png",spacing:.02},{name:"grunge4",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge4.png"},thumbnail:"brushes/stamp_grunge4.png",spacing:.02},{name:"grunge5",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge5.png"},thumbnail:"brushes/thumb_stamp_grunge5.gif",spacing:.02},{name:"leaf1",materialOptions:{type:"shaded",angleJitter:Math.PI,textureSrc:"brushes/stamp_leaf1.png"},thumbnail:"brushes/stamp_leaf1.png",spacing:.03},{name:"leaf2",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf2.png"},thumbnail:"brushes/thumb_stamp_leaf2.gif",spacing:.03},{name:"leaf3",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf3.png"},thumbnail:"brushes/thumb_stamp_leaf3.gif",spacing:.03},{name:"fur1",materialOptions:{type:"shaded",angleJitter:40*Math.PI/180,subTextures:2,textureSrc:"brushes/stamp_fur1.png"},thumbnail:"brushes/stamp_fur1.png",spacing:.01},{name:"fur2",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_fur2.png"},thumbnail:"brushes/stamp_fur2.png",spacing:.01},{name:"grass",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_grass.png"},thumbnail:"brushes/thumb_stamp_grass.png",spacing:.03},{name:"bush",materialOptions:{type:"shaded",subTextures:2,textureSrc:"brushes/stamp_bush.png"},thumbnail:"brushes/thumb_stamp_bush.gif",spacing:.04},{name:"star",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_star.png"},thumbnail:"brushes/thumb_stamp_star.png",spacing:.06},{name:"snow",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_snow.png"},thumbnail:"brushes/thumb_stamp_snow.png",spacing:.06}],d=0;d<l.length;d++){var m=l[d];m.materialOptions.textureSrc&&(m.materialOptions.map=window.atlas.map,m.materialOptions.converter=window.atlas.getUVConverters(m.materialOptions.textureSrc),delete m.materialOptions.textureSrc),AFRAME.registerBrush(m.name,Object.assign({},c,{materialOptions:m.materialOptions}),{thumbnail:m.thumbnail,spacing:m.spacing,maxPoints:3e3})}}()},620:()=>{var e,t,i;AFRAME.registerComponent("brush",{schema:{color:{type:"color",default:"#ef2d5e"},size:{default:.01,min:.001,max:.3},brush:{default:"smooth"},enabled:{default:!0}},init:function(){var e=this.data;this.color=new THREE.Color(e.color),this.el.emit("brushcolor-changed",{color:this.color}),this.el.emit("brushsize-changed",{brushSize:e.size}),this.active=!1,this.obj=this.el.object3D,this.currentStroke=null,this.strokeEntities=[],this.sizeModifier=0,this.textures={},this.currentMap=0,this.model=this.el.getObject3D("mesh"),this.drawing=!1;var t=this;this.el.addEventListener("undo",(function(e){t.data.enabled&&(t.system.undo(),document.getElementById("ui_undo").play())})),this.el.addEventListener("paint",(function(e){if(t.data.enabled){var i=e.detail.value;t.sizeModifier=i,i>.1?t.active||(t.startNewStroke(),t.active=!0):(t.active&&(t.previousEntity=t.currentEntity,t.currentStroke=null),t.active=!1)}}))},update:function(e){var t=this.data;e.color!==t.color&&(this.color.set(t.color),this.el.emit("brushcolor-changed",{color:this.color})),e.size!==t.size&&this.el.emit("brushsize-changed",{size:t.size})},tick:(e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3,function(s,r){if(this.currentStroke&&this.active){this.obj.matrixWorld.decompose(e,t,i);var n=this.system.getPointerPosition(e,t);this.currentStroke.addPoint(e,t,n,this.sizeModifier,s)}}),startNewStroke:function(){document.getElementById("ui_paint").play(),this.currentStroke=this.system.addNewStroke(this.data.brush,this.color,this.data.size),this.el.emit("stroke-started",{entity:this.el,stroke:this.currentStroke})}})},116:()=>{var e=AFRAME.utils;AFRAME.registerComponent("if-no-vr-headset",{schema:{default:{},parse:e.styleParser.parse},update:function(){var e=this;this.el.sceneEl.isMobile?this.setProperties():navigator.xr.isSessionSupported("immersive-vr").then((function(t){t||e.setProperties()}))},setProperties:function(){var e=this.data,t=this.el;Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}})},510:()=>{AFRAME.registerComponent("json-model",{schema:{src:{type:"asset"}},init:function(){this.objectLoader=new THREE.ObjectLoader,this.objectLoader.setCrossOrigin("")},update:function(e){var t=this,i=this.data.src;i&&i!==e.src&&this.objectLoader.load(this.data.src,(function(e){var s=(new THREE.Matrix4).makeRotationX(-Math.PI/2);e.traverse((function(e){e instanceof THREE.Mesh&&e.position.applyMatrix4(s)})),t.el.setObject3D("mesh",e),t.el.emit("model-loaded",{format:"json",model:e,src:i})}))}})},174:()=>{AFRAME.registerComponent("orbit-controls",{dependencies:["camera"],schema:{position:{default:{x:0,y:1.6,z:.1},type:"vec3"}},init:function(){var e=this.el.sceneEl,t=this.setupControls.bind(this);this.el.sceneEl.is("vr-mode")||this.el.setAttribute("position",this.data.position),e.canvas?t():e.addEventListener("render-target-loaded",t),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),e.addEventListener("enter-vr",this.onEnterVR),e.addEventListener("exit-vr",this.onExitVR)},onExitVR:function(){this.el.setAttribute("position",this.data.position),this.controls.enabled=!0},onEnterVR:function(){if(AFRAME.utils.device.checkHeadsetConnected()||this.el.sceneEl.isMobile){var e=this.el.getAttribute("position"),t=this.el.getObject3D("camera");this.controls.enabled=!1,t.position.set(0,0,0),t.rotation.set(0,0,0),this.el.sceneEl.isMobile||this.el.setAttribute("position",{x:e.x-this.data.position.x,y:e.y-this.data.position.y,z:e.z-this.data.position.z})}},setupControls:function(){var e=this.el.sceneEl.renderer,t=this.el.getObject3D("camera"),i=this.controls=new THREE.OrbitControls(t,e.domElement),s=this.el.getAttribute("position");i.target.setX(-s.x),i.target.setZ(-s.z),i.enableDamping=!0,i.dampingFactor=1,i.enableZoom=!0},play:function(){this.controls&&(this.controls.enabled=!0)},pause:function(){this.controls&&(this.controls.enabled=!1)},remove:function(){this.pause()}})},101:()=>{AFRAME.registerSystem("paint-controls",{numberStrokes:0}),AFRAME.registerComponent("paint-controls",{dependencies:["brush"],schema:{hand:{default:"left"}},init:function(){var e=this.el,t=this,i="assets/images/controller-pressed.png",s=null;this.controller=null,this.modelLoaded=!1,this.onModelLoaded=this.onModelLoaded.bind(this),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("changeBrushSizeAbs",(function(i){if(0!==i.detail.axis[1]||0!==i.detail.axis[3]){var s=(i.detail.axis[1]||i.detail.axis[3])/300,r=e.components.brush.schema.size,n=THREE.Math.clamp(t.el.getAttribute("brush").size-s,r.min,r.max);t.el.setAttribute("brush","size",n)}})),e.addEventListener("changeBrushSizeInc",(function(i){if(0!==i.detail.axis[1]||0!==i.detail.axis[3]){var s=i.detail.axis[1]||i.detail.axis[3];t.touchStarted&&(t.touchStarted=!1,t.startAxis=(s+1)/2);var r=(s+1)/2,n=(t.startAxis-r)/2;t.startAxis=r;var a=t.el.getAttribute("brush").size,o=e.components.brush.schema.size,h=THREE.Math.clamp(a-n,o.min,o.max);t.el.setAttribute("brush","size",h)}})),t.touchStarted=!1,e.addEventListener("startChangeBrushSize",(function(){t.touchStarted=!0})),e.addEventListener("controllerconnected",(function(t){var i=t.detail.name;if("windows-motion-controls"===i){var r=t.detail.component.el.components["gltf-model"].data;const e="045E-065D";r&&r.indexOf(e)>=0&&(i="windows-motion-samsung-controls")}if(s=Utils.getTooltips(i),i.indexOf("windows-motion")>=0);else if("oculus-touch-controls"===i){var n=t.detail.component.data.hand;e.setAttribute("obj-model",{obj:"assets/models/oculus-"+n+"-controller.obj",mtl:"https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-"+n+".mtl"})}else{if("vive-controls"!==i)return;e.setAttribute("json-model",{src:"assets/models/controller_vive.json"})}s&&s.forEach((function(e){e.setAttribute("visible",!0)})),this.controller=i})),e.addEventListener("brushsize-changed",(function(e){t.changeBrushSize(e.detail.size)})),e.addEventListener("brushcolor-changed",(function(e){t.changeBrushColor(e.detail.color)})),e.sceneEl.systems.material.loadTexture(i,{src:i},(function(e){var i=t.highLightMaterial=new THREE.MeshBasicMaterial;i.map=e,i.needsUpdate=!0})),this.startAxis=0,this.numberStrokes=0,this.hideTooltips=null,this.hidingTooltips=!1,this.time=0,document.addEventListener("stroke-started",(function(e){if(e.detail.entity.components["paint-controls"]===t&&(t.numberStrokes++,t.system.numberStrokes++,3===t.system.numberStrokes)){var i=Array.prototype.slice.call(document.querySelectorAll("[tooltip]")),s={opacity:1};t.hideTooltips=AFRAME.ANIME({targets:s,opacity:0,duration:1e3,delay:2e3,update:function(){i.forEach((function(e){e.setAttribute("tooltip",{opacity:s.opacity})}))},complete:function(){i.forEach((function(e){e.setAttribute("visible",!1)})),this.hidingTooltips=!1}}),t.hideTooltips.play(),t.hidingTooltips=!0}}))},changeBrushColor:function(e){this.modelLoaded&&this.buttonMeshes.sizeHint&&(this.buttonMeshes.colorTip.material.color.copy(e),this.buttonMeshes.sizeHint.material.color.copy(e))},changeBrushSize:function(e){var t=e/2*10;this.modelLoaded&&this.buttonMeshes.sizeHint&&this.buttonMeshes.sizeHint.scale.set(t,t,1)},mapping:{axis0:"trackpad",axis1:"trackpad",button0:"trackpad",button1:"trigger",button2:"grip",button3:"menu",button4:"system"},update:function(){var e=this.data,t=this.el;t.setAttribute("vive-controls",{hand:e.hand,model:!1}),t.setAttribute("oculus-touch-controls",{hand:e.hand,model:!1}),t.setAttribute("windows-motion-controls",{hand:e.hand})},tick:function(e,t){this.hidingTooltips&&(this.time+=t,this.hideTooltips.tick(this.time))},play:function(){},pause:function(){},onModelLoaded:function(e){if(e.target===this.el){var t,i=e.detail.model;(t=this.buttonMeshes={}).sizeHint=i.getObjectByName("sizehint"),t.colorTip=i.getObjectByName("tip"),this.modelLoaded=!0,this.changeBrushSize(this.el.components.brush.data.size),this.changeBrushColor(this.el.components.brush.color)}},onButtonEvent:function(e,t){var i=this.mapping["button"+e];this.el.emit(i+t),this.updateModel(i,t)},updateModel:function(e,t){var i="up"===t?this.material:this.highLightMaterial,s=this.buttonMeshes,r=s&&s[e];if("down"===t&&r&&!this.material&&(i=this.material=r.material),i)return"grip"===e?(s.grip.left.material=i,void(s.grip.right.material=i)):void(r&&(r.material=i))}})},579:()=>{var e,t,i;AFRAME.registerComponent("ui-raycaster",{schema:{far:{default:1/0},interval:{default:100},near:{default:0},objects:{default:""},recursive:{default:!0},rotation:{default:0}},init:function(){this.direction=new THREE.Vector3,this.intersectedEls=[],this.objects=null,this.prevCheckTime=void 0,this.raycaster=new THREE.Raycaster,this.updateOriginDirection(),this.refreshObjects=this.refreshObjects.bind(this)},play:function(){this.el.sceneEl.addEventListener("child-attached",this.refreshObjects),this.el.sceneEl.addEventListener("child-detached",this.refreshObjects)},pause:function(){this.el.sceneEl.removeEventListener("child-attached",this.refreshObjects),this.el.sceneEl.removeEventListener("child-detached",this.refreshObjects)},update:function(){var e=this.data,t=this.raycaster;t.far=e.far,t.near=e.near,this.refreshObjects()},refreshObjects:function(){var e,t,i=this.data;if(i.objects)for(t=this.el.sceneEl.querySelectorAll(i.objects),this.objects=[],e=0;e<t.length;e++)this.objects.push(t[e].object3D);else this.objects=this.el.sceneEl.object3D.children},tick:function(e){var t,i,s,r=this.el,n=this.data,a=this.prevCheckTime;a&&e-a<n.interval||(s=this.intersectedEls.slice(),this.updateOriginDirection(),i=(i=this.raycaster.intersectObjects(this.objects,n.recursive)).filter((function(e){return!!e.object.el})),t=this.intersectedEls=i.map((function(e){return e.object.el})),i.forEach((function(e){e.object.el.emit("raycaster-intersected",{el:r,intersection:e})})),i.length&&r.emit("raycaster-intersection",{els:t,intersections:i}),s.forEach((function(e){-1===t.indexOf(e)&&(r.emit("raycaster-intersection-cleared",{el:e}),e.emit("raycaster-intersected-cleared",{el:r}))})))},updateOriginDirection:(e=new THREE.Quaternion,t=new THREE.Vector3,i=new THREE.Vector3,function(){var s=this.el,r=this.direction,n=s.object3D;n.updateMatrixWorld(),n.matrixWorld.decompose(t,e,i),r.set(0,0,-1),r.applyAxisAngle(new THREE.Vector3(1,0,0),this.data.rotation/360*2*Math.PI),r.applyQuaternion(e),this.raycaster.set(t,r)})})},688:()=>{var e,t,i,s,r,n;AFRAME.registerComponent("ui",{schema:{brightness:{default:1,max:1,min:0}},dependencies:["ui-raycaster"],init:function(){var e=this.el,t=this.uiEl=document.createElement("a-entity"),i=this.rayEl=document.createElement("a-entity");this.closed=!0,this.isTooltipPaused=!1,this.colorStack=["#272727","#727272","#FFFFFF","#24CAFF","#249F90","#F2E646","#EF2D5E"],this.bindMethods(),this.colorHasChanged=!0,this.highlightMaterials={},this.intersectedObjects=[],this.hoveredOffObjects=[],this.hoveredOnObjects=[],this.pressedObjects={},this.selectedObjects={},this.unpressedObjects={},this.brushButtonsMapping={},this.brushRegexp=/^(?!.*(fg|bg)$)brush[0-9]+/,this.colorHistoryRegexp=/^(?!.*(fg|bg)$)colorhistory[0-9]+$/,this.hsv={h:0,s:0,v:1},this.rayAngle=45,this.rayDistance=.2,this.openMenu=null,this.openingMenu=!1,this.closeMenu=null,this.closingMenu=!1,this.showMessageWindow=null,this.showingMessage=!1,this.time=0,this.cursorOffset=new THREE.Vector3(.06409,.01419,-.10242),t.setAttribute("material",{color:"#ffffff",flatShading:!0,shader:"flat",transparent:!0,fog:!1,src:"#uinormal"}),t.setAttribute("obj-model","obj:#uiobj"),t.setAttribute("position","0 0.04 -0.15"),t.setAttribute("scale","0 0 0"),t.setAttribute("visible",!1),t.classList.add("apainter-ui"),e.appendChild(t),i.setAttribute("line",""),e.appendChild(i),e.setAttribute("ui-raycaster",{far:this.rayDistance,objects:".apainter-ui",rotation:-this.rayAngle}),this.controller=null;var s=this;e.addEventListener("controllerconnected",(function(i){var r=i.detail.name;s.tooltips=Utils.getTooltips(r),s.controller={name:r,hand:i.detail.component.data.hand},"oculus-touch-controls"===r?(s.uiEl.setAttribute("rotation","45 0 0"),t.setAttribute("position","0 0.13 -0.08"),s.rayAngle=0,e.setAttribute("ui-raycaster",{rotation:0})):"windows-motion-controls"===r&&(s.rayAngle=25,s.rayDistance=1,e.setAttribute("ui-raycaster",{rotation:-30,far:s.rayDistance})),s.el.isPlaying&&s.addToggleEvent()}))},initColorWheel:function(){var e=this.objects.hueWheel,t=new THREE.ShaderMaterial({uniforms:{brightness:{type:"f",value:this.hsv.v}},vertexShader:"      varying vec2 vUv;      void main() {        vUv = uv;        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);        gl_Position = projectionMatrix * mvPosition;      }      ",fragmentShader:"      #define M_PI2 6.28318530718\n       uniform float brightness;      varying vec2 vUv;      vec3 hsb2rgb(in vec3 c){          vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0,                            0.0,                            1.0 );          rgb = rgb * rgb * (3.0 - 2.0 * rgb);          return c.z * mix( vec3(1.0), rgb, c.y);      }            void main() {        vec2 toCenter = vec2(0.5) - vUv;        float angle = atan(toCenter.y, toCenter.x);        float radius = length(toCenter) * 2.0;        vec3 color = hsb2rgb(vec3((angle / M_PI2) + 0.5, radius, brightness));        gl_FragColor = vec4(color, 1.0);      }      "});e.material=t},bindMethods:function(){this.onComponentChanged=this.onComponentChanged.bind(this),this.onTriggerChanged=this.onTriggerChanged.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersected=this.onIntersected.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onIntersectedCleared=this.onIntersectedCleared.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onStrokeStarted=this.onStrokeStarted.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.open=this.open.bind(this),this.close=this.close.bind(this)},tick:function(e,t){!this.closed&&this.handEl&&(this.updateIntersections(),this.handleHover(),this.handlePressedButtons()),this.openingMenu?(this.time+=t,this.openMenu.tick(this.time)):this.closingMenu?(this.time+=t,this.closeMenu.tick(this.time)):this.showingMessage&&(this.time+=t,this.showMessageWindow.tick(this.time))},onTriggerChanged:function(e){var t=e.detail.value;this.lastTriggerValue=t,e.detail.value>=.25?this.triggeredPressed=!0:(this.triggeredPressed=!1,this.handleButtonUp())},handleButtonDown:function(e,t){var i=e.name;if(!this.activeWidget||this.activeWidget===i){switch(this.activeWidget=i,!0){case"brightness"===i:this.onBrightnessDown(t);break;case"brushnext"===i:this.pressedObjects[i]||this.nextPage();break;case"brushprev"===i:this.pressedObjects[i]||this.previousPage();break;case"clear"===i:this.pressedObjects[i]||(this.el.sceneEl.systems.brush.clear(),this.playSound("ui_click1"));break;case"copy"===i:this.pressedObjects[i]||(this.copyBrush(),this.playSound("ui_click1"));break;case"hue"===i:this.onHueDown(t);break;case"save"===i:this.pressedObjects[i]||(this.el.sceneEl.systems.painter.upload(),this.playSound("ui_click1"));break;case"sizebg"===i:this.onBrushSizeBackgroundDown(t);break;case this.brushRegexp.test(i):this.onBrushDown(i);break;case this.colorHistoryRegexp.test(i):this.onColorHistoryButtonDown(e);break;default:this.activeWidget=void 0}this.pressedObjects[i]=e}},copyBrush:function(){var e=this.el.getAttribute("brush");this.handEl.setAttribute("brush","brush",e.brush),this.handEl.setAttribute("brush","color",e.color),this.handEl.setAttribute("brush","size",e.size),this.colorHasChanged=!0},handleButtonUp:function(){var e=this.pressedObjects,t=this.unpressedObjects;this.activeWidget=void 0,Object.keys(e).forEach((function(i){var s=e[i].name;t[s]=e[s],delete e[s]}))},handlePressedButtons:function(){var e=this;this.triggeredPressed&&this.hoveredOnObjects.forEach((function(t){e.handleButtonDown(t.object,t.point)}))},onColorHistoryButtonDown:function(e){var t=e.material.color.getHexString();this.handEl.setAttribute("brush","color","#"+t),this.playSound("ui_click0",e.name)},onBrushDown:function(e){var t=this.brushButtonsMapping[e];t&&(this.selectBrushButton(e),this.handEl.setAttribute("brush","brush",t.toLowerCase()))},selectBrushButton:function(e){var t=this.uiEl.getObject3D("mesh").getObjectByName(e+"bg"),i=this.selectedObjects,s=this.selectedBrush;s&&(this.highlightMaterials[s.name]||this.initHighlightMaterial(t),s.material=this.highlightMaterials[s.name].normal,delete i[s.name]),i[t.name]=t,this.selectedBrush=t,this.playSound("ui_click1",e)},onHueDown:function(e){var t,i=this.objects.hueWheel,s=this.colorWheelSize;i.updateMatrixWorld(),i.worldToLocal(e),this.objects.hueCursor.position.copy(e);var r=((t={r:Math.sqrt(e.x*e.x+e.z*e.z),theta:Math.PI+Math.atan2(-e.z,e.x)}).theta*(180/Math.PI)+180)%360;this.hsv.h=r/360,this.hsv.s=t.r/s,this.updateColor(),this.playSound("ui_click0","hue")},updateColor:function(){var e=this.hsv2rgb(this.hsv),t="rgb("+e.r+", "+e.g+", "+e.b+")";this.handEl.setAttribute("brush","color",t),this.colorHasChanged=!0},hsv2rgb:function(e){var t,i,s,r,n,a,o,h,u=THREE.Math.clamp(e.h,0,1),c=THREE.Math.clamp(e.s,0,1),l=e.v;switch(a=l*(1-c),o=l*(1-(n=6*u-(r=Math.floor(6*u)))*c),h=l*(1-(1-n)*c),r%6){case 0:t=l,i=h,s=a;break;case 1:t=o,i=l,s=a;break;case 2:t=a,i=l,s=h;break;case 3:t=a,i=o,s=l;break;case 4:t=h,i=a,s=l;break;case 5:t=l,i=a,s=o}return{r:Math.round(255*t),g:Math.round(255*i),b:Math.round(255*s)}},rgb2hsv:function(e,t,i){var s,r=Math.max(e,t,i),n=Math.min(e,t,i),a=r-n,o=0===r?0:a/r,h=r;switch(1===arguments.length&&(t=e.g,i=e.b,e=e.r),r){case n:s=0;break;case e:s=t-i+a*(t<i?6:0),s/=6*a;break;case t:s=i-e+2*a,s/=6*a;break;case i:s=e-t+4*a,s/=6*a}return{h:s,s:o,v:h}},onBrightnessDown:function(e){var t=this.objects.brightnessSlider,i=t.geometry.boundingBox,s=i.max.z-i.min.z;t.updateMatrixWorld(),t.worldToLocal(e);var r=1-(e.z-i.min.z)/s;r=THREE.Math.clamp(1.29*r-.12,0,1),this.objects.hueWheel.material.uniforms.brightness.value=r,this.objects.brightnessCursor.rotation.y=1.5*r-1.5,this.hsv.v=r,this.updateColor(),this.playSound("ui_click0","brightness")},onBrushSizeBackgroundDown:function(e){var t=this.objects.sizeSlider,i=t.geometry.boundingBox,s=i.max.x-i.min.x;t.updateMatrixWorld(),t.worldToLocal(e);var r=(e.x-i.min.x)/s;r*=AFRAME.components.brush.schema.size.max,this.handEl.setAttribute("brush","size",r),this.playSound("ui_click0","sizebg")},handleHover:function(){this.updateHoverObjects(),this.updateMaterials()},updateHoverObjects:function(){var e=this.intersectedObjects;e=e.filter((function(e){return"bb"!==e.object.name&&"msg_save"!==e.object.name})),this.hoveredOffObjects=this.hoveredOnObjects.filter((function(t){return-1===e.indexOf(t)})),this.hoveredOnObjects=e},updateMaterials:(n=new THREE.Vector3,function(){var e=this,t=this.pressedObjects,i=this.unpressedObjects,s=this.selectedObjects;this.hoveredOffObjects.forEach((function(t){var i=t.object;i.material=e.highlightMaterials[i.name].normal})),this.hoveredOnObjects.forEach((function(t){var i=t.object;n.copy(t.point),e.highlightMaterials[i.name]||e.initHighlightMaterial(i),e.handRayEl.object3D.worldToLocal(n),e.handRayEl.setAttribute("line","end",n),i.material=e.highlightMaterials[i.name].hover})),Object.keys(t).forEach((function(i){var s=t[i],r=e.highlightMaterials[s.name];s.material=r.pressed||s.material})),Object.keys(i).forEach((function(t){var s=i[t],r=e.highlightMaterials[s.name];s.material=r.normal,delete i[t]})),Object.keys(s).forEach((function(t){var i=s[t],r=e.highlightMaterials[i.name];r&&(i.material=r.selected)}))}),addToggleEvent:function(){this.el.addEventListener("toggleMenu",this.toggleMenu)},removeToggleEvent:function(){this.el.removeEventListener("toggleMenu",this.toggleMenu)},play:function(){var e=this.el,t=this.handEl;this.controller&&this.addToggleEvent(),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("raycaster-intersection",this.onIntersection),e.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),e.addEventListener("raycaster-intersected",this.onIntersected),e.addEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),t&&this.addHandListeners()},pause:function(){var e=this.el,t=this.handEl;this.controller&&this.removeToggleEvent(),e.removeEventListener("raycaster-intersection",this.onIntersection),e.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),e.removeEventListener("raycaster-intersected",this.onIntersected),e.removeEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),t&&this.removeHandListeners()},onModelLoaded:function(e){var t=this.uiEl.getObject3D("mesh");if(t=e.detail.model,"obj"===e.detail.format&&t.getObjectByName("brightnesscursor")){this.objects={},this.objects.brightnessCursor=t.getObjectByName("brightnesscursor"),this.objects.brightnessSlider=t.getObjectByName("brightness"),this.objects.brightnessSlider.geometry.computeBoundingBox(),this.objects.previousPage=t.getObjectByName("brushprev"),this.objects.nextPage=t.getObjectByName("brushnext"),this.objects.hueCursor=t.getObjectByName("huecursor"),this.objects.hueWheel=t.getObjectByName("hue"),this.objects.hueWheel.geometry.computeBoundingSphere(),this.colorWheelSize=this.objects.hueWheel.geometry.boundingSphere.radius,this.objects.sizeCursor=t.getObjectByName("size"),this.objects.sizeCursor.position.copy(this.cursorOffset),this.objects.colorHistory=[];for(var i=0;i<7;i++)this.objects.colorHistory[i]=t.getObjectByName("colorhistory"+i);this.objects.currentColor=t.getObjectByName("currentcolor"),this.objects.sizeSlider=t.getObjectByName("sizebg"),this.objects.sizeSlider.geometry.computeBoundingBox(),t.getObjectByName("bb").material=new THREE.MeshBasicMaterial({color:2395940,alphaTest:0,visible:!1});var s=this;this.messagesMaterial=new THREE.MeshBasicMaterial({map:null,transparent:!0,opacity:0}),this.objects.messageSave=t.getObjectByName("msg_save"),this.objects.messageSave.material=this.messagesMaterial,this.objects.messageSave.visible=!1,this.objects.messageError=t.getObjectByName("msg_error"),this.objects.messageError.visible=!1,this.objects.messageError.material=this.messagesMaterial;var r="assets/images/messages.png";this.el.sceneEl.systems.material.loadTexture(r,{src:r},(function(e){var t=s.messagesMaterial;t.map=e,t.needsUpdate=!0})),this.el.sceneEl.addEventListener("drawing-upload-completed",(function(e){n(s.objects.messageSave)})),this.el.sceneEl.addEventListener("drawing-upload-error",(function(e){n(s.objects.messageError)})),this.initColorWheel(),this.initColorHistory(),this.initBrushesMenu(),this.setCursorTransparency(),this.updateColorUI(this.el.getAttribute("brush").color),this.updateSizeSlider(this.el.getAttribute("brush").size)}function n(e){e.visible=!0;var t={opacity:0};s.showMessageWindow=AFRAME.ANIME.timeline({duration:4e3}),s.showMessageWindow.add({targets:t,opacity:1,duration:500,update:function(){s.messagesMaterial.opacity=t.opacity}}),s.showMessageWindow.add({targets:t,opacity:0,duration:500,delay:3e3,update:function(){s.messagesMaterial.opacity=t.opacity},complete:function(){e.visible=!1,s.showingMessage=!1,s.time=0}}),s.showMessageWindow.play(),s.showingMessage=!0}},initBrushesMenu:function(){var e=this.objects.previousPage,t=this.objects.nextPage,i=Object.keys(AFRAME.BRUSHES);this.initHighlightMaterial(t),this.initHighlightMaterial(e),e.visible=!1,t.visible=!1,this.brushesPerPage=15,this.brushesPagesNum=Math.ceil(i.length/this.brushesPerPage),this.brushesPage=0,this.loadBrushes(this.brushesPage,this.brushesPerPage)},setCursorTransparency:function(){var e=this.objects.hueCursor,t=this.objects.brightnessCursor,i=this.objects.sizeCursor;i.material.alphaTest=.5,e.material.alphaTest=.5,t.material.alphaTest=.5,i.material.transparent=!0,e.material.transparent=!0,t.material.transparent=!0},loadBrushes:(r={},function(e,t){var i,s,n=0,a=this.uiEl.getObject3D("mesh"),o=Object.keys(AFRAME.BRUSHES),h=this;if(!(e<0||e>=this.brushesPagesNum))for(this.objects.previousPage.visible=0!==e,e===this.brushesPagesNum-1?this.objects.nextPage.visible=!1:this.objects.nextPage.visible=!0,s=0;s<t;s++)u(i=o[e*t+s],n,i&&AFRAME.BRUSHES[i].prototype.options.thumbnail),n+=1;function u(e,t,i){var s=e?(e.charAt(0).toUpperCase()+e.slice(1)).toLowerCase():void 0;function n(e){var i=a.getObjectByName("brush"+t);h.brushButtonsMapping["brush"+t]=s,function(e,t){var i=h.brushButtonsMapping[t.name],s=r[i]||new THREE.MeshBasicMaterial;e?(s.map=e,s.alphaTest=.5,s.transparent=!0):r[i]||(s.visible=!1),r[i]=s,h.highlightMaterials[t.name]={normal:s,hover:s,pressed:s,selected:s},t.material=s}(e,i)}!i||r[s]?n():h.el.sceneEl.systems.material.loadTexture(i,{src:i},n)}}),nextPage:function(){this.brushesPage>=this.brushesPagesNum-1||(this.brushesPage++,this.loadBrushes(this.brushesPage,this.brushesPerPage),this.playSound("ui_click1"))},previousPage:function(){0!==this.brushesPage&&(this.brushesPage--,this.loadBrushes(this.brushesPage,this.brushesPerPage),this.playSound("ui_click1"))},initHighlightMaterial:function(e){var t=e.name,i=this.brushRegexp.test(t),s=-1!==t.indexOf("history"),r="hue"===t||"huecursor"===t,n={normal:e.material,hover:e.material,pressed:e.material,selected:e.material};i||s||r||(n.normal=e.material,n.hover=e.material.clone(),n.hover.map=this.system.hoverTexture,n.selected=e.material.clone(),n.selected.map=this.system.pressedTexture,n.pressed=e.material.clone(),n.pressed.map=this.system.pressedTexture),this.highlightMaterials[t]=n},toggleMenu:function(e){this.closed?(this.system.closeAll(),this.open(),this.system.opened=this.el):(this.close(),this.system.opened=void 0)},open:function(){var e=this.uiEl,t={x:0,y:0,z:0};if(this.closed){this.uiEl.setAttribute("visible",!0);var i=this;if(this.openMenu=AFRAME.ANIME({targets:t,x:1,y:1,z:1,duration:100,easing:"easeOutExpo",update:function(){e.setAttribute("scale",t)},complete:function(){i.openingMenu=!1,i.time=0}}),this.openMenu.play(),this.openingMenu=!0,this.el.setAttribute("brush","enabled",!1),this.rayEl.setAttribute("visible",!1),this.closed=!1,this.tooltips){i=this;this.tooltips.forEach((function(t){t.getAttribute("visible")&&e.parentEl.id!==t.parentEl.id&&(i.isTooltipPaused=!0,t.setAttribute("visible",!1))}))}this.playSound("ui_menu")}},updateIntersections:function(){var e=this.raycaster=new THREE.Raycaster;return function(t){this.updateRaycaster(e),this.intersectedObjects=e.intersectObjects(this.menuEls,!0)}}(),onIntersection:function(e){var t=this.closed&&this.system.opened;this.el.components.brush.active||(this.rayEl.setAttribute("visible",!!t),this.el.setAttribute("brush","enabled",!1))},onIntersected:function(e){var t=e.detail.el;this.handEl&&this.removeHandListeners(),this.handEl=t,this.handRayEl=this.handEl.components.ui.rayEl,this.menuEls=this.uiEl.object3D.children,this.syncUI(),this.addHandListeners()},addHandListeners:function(){var e=this.handEl;e.addEventListener("componentchanged",this.onComponentChanged),e.addEventListener("stroke-started",this.onStrokeStarted),e.addEventListener("triggerchanged",this.onTriggerChanged)},removeHandListeners:function(){var e=this.handEl;e.removeEventListener("componentchanged",this.onComponentChanged),e.removeEventListener("stroke-started",this.onStrokeStarted),e.removeEventListener("triggerchanged",this.onTriggerChanged)},onComponentChanged:function(e){"brush"===e.detail.name&&this.syncUI()},syncUI:function(){var e;this.handEl&&this.objects&&(e=this.handEl.getAttribute("brush"),this.updateSizeSlider(e.size),this.updateColorUI(e.color),this.updateColorHistory())},initColorHistory:function(){for(var e,t=this.objects.currentColor,i=0;i<this.objects.colorHistory.length;i++)(e=this.objects.colorHistory[i]).material=e.material.clone(),e.material.map=this.system.selectedTexture;t.material=t.material.clone(),t.material.map=this.system.selectedTexture,this.updateColorHistory()},updateColorHistory:function(){var e=this.handEl&&this.handEl.getAttribute("brush").color,t=this.colorStack;e||(e=this.el.components.brush.schema.color.default),this.objects.currentColor.material.color.set(e);for(var i=0;i<t.length;i++)e=t[t.length-i-1],this.objects.colorHistory[i].material.color.set(e)},updateSizeSlider:function(e){var t=this.objects.sizeSlider.geometry.boundingBox,i=this.objects.sizeCursor,s=t.max.x-t.min.x,r=e/AFRAME.components.brush.schema.size.max,n=r*s;i.position.setX(n-this.cursorOffset.x);var a=r+.3;i.scale.set(a,1,a)},updateColorUI:function(e){var t=new THREE.Color(e),i=this.hsv=this.rgb2hsv(t.r,t.g,t.b),s=2*i.h*Math.PI,r=i.s*this.colorWheelSize,n=r*Math.cos(s),a=r*Math.sin(s);this.objects.hueCursor.position.setX(n),this.objects.hueCursor.position.setZ(-a),this.objects.hueWheel.material.uniforms.brightness.value=this.hsv.v,this.objects.brightnessCursor.rotation.y=1.5*this.hsv.v-1.5},updateBrushSelector:function(e){var t=this,i=Object.keys(this.brushButtonsMapping),s=this.brushButtonsMapping;i.forEach((function(i){s[i]===e&&t.selectBrushButton(i)}))},onIntersectionCleared:function(){this.checkMenuIntersections=!1,this.rayEl.setAttribute("visible",!1),this.el.setAttribute("brush","enabled",!0)},onIntersectedCleared:function(e){this.handEl&&this.handEl.removeEventListener("triggerchanged",this.onTriggerChanged)},onStrokeStarted:function(){var e,t=this.colorStack;this.colorHasChanged&&(e=this.handEl.getAttribute("brush").color,this.colorHasChanged=!1,7===t.length&&t.shift(),t.push(e),this.syncUI())},updateRaycaster:(e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3,s=new THREE.Vector3,function(r){var n=this.handEl.object3D;n.updateMatrixWorld(),n.matrixWorld.decompose(s,t,i),e.set(0,0,-1),e.applyAxisAngle(new THREE.Vector3(1,0,0),-this.rayAngle/360*2*Math.PI),e.applyQuaternion(t),r.far=this.rayDistance,r.set(s,e)}),close:function(){var e=this.uiEl,t={x:1,y:1,z:1};if(!this.closed){var i=this;this.closeMenu=AFRAME.ANIME({targets:t,x:0,y:0,z:0,duration:100,easing:"easeOutExpo",update:function(){e.setAttribute("scale",t)},complete:function(){e.setAttribute("visible",!1),i.closingMenu=!1,i.time=0}}),this.closeMenu.play(),this.el.setAttribute("brush","enabled",!0),this.closed=!0,this.closingMenu=!0,this.tooltips&&this.isTooltipPaused&&(this.isTooltipPaused=!1,this.tooltips.forEach((function(e){e.setAttribute("visible",!0)}))),this.playSound("ui_menu")}},playSound:function(e,t){void 0!==t&&this.pressedObjects[t]||document.getElementById(e).play()}})},821:()=>{window.addEventListener("load",(function(e){var t=document.body;t.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),!1),t.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault();for(var t=e.dataTransfer.files,i=0;i<t.length;i++){var s=t[i];if(".apa"===s.name.substr(s.name.length-4).toLowerCase())(r=new FileReader).onload=function(e){document.querySelector("a-scene").systems.brush.loadBinary(e.target.result)},r.readAsArrayBuffer(s);else if(".json"===s.name.substr(s.name.length-5).toLowerCase()){var r;(r=new FileReader).onload=function(e){document.querySelector("a-scene").systems.brush.loadJSON(JSON.parse(e.target.result))},r.readAsText(s)}else".obj"===s.name.substr(s.name.length-4).toLowerCase()?((r=new FileReader).onload=function(e){for(var t=(new AFRAME.THREE.OBJLoader).parse(e.target.result),i=document.createElement("a-entity"),s=0;s<t.children.length;s++){t.children[s].material.color.set("#333")}i.setObject3D("mesh",t),i.className="templateitem",document.querySelector("a-scene").appendChild(i)},r.readAsText(s)):s.type.match(/image.*/)&&((r=new FileReader).onload=function(e){var t,i,s=new Image;s.src=e.target.result,s.width>s.height?(t=1,i=s.height/s.width):(i=1,t=s.width/s.height);var r=[3*Math.random()-1.5,1+Math.random()-.5,.2*Math.random()-1.4],n=document.createElement("a-image");n.setAttribute("src",e.target.result),n.setAttribute("position",r.join(" ")),n.setAttribute("width",t),n.setAttribute("height",i),n.className="templateitem",document.querySelector("a-scene").appendChild(n)},r.readAsDataURL(s))}}),!1)}))},51:e=>{e.exports=function(e){function t(){var t=document.querySelector("a-scene");t.hasLoaded?e():t.addEventListener("loaded",e())}"complete"===document.readyState||"loaded"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)}},115:e=>{function t(e){this.material=e,this.maxBufferSize=1e6,this.geometries=[],this.current=null,this.addBuffer(!1)}t.prototype={restartPrimitive:function(){if(this.idx.position>=this.current.attributes.position.count)this.addBuffer(!1);else if(0!==this.idx.position){var e=3*(this.idx.position-1),t=this.current.attributes.position.array;this.addVertex(t[e++],t[e++],t[e++]),this.idx.color++,this.idx.normal++,this.idx.uv++}},remove:function(e,t){var i=this.current.attributes.position.array;if(this.idx.position>t.position)for(key in this.idx)for(var s="uv"===key?2:3,r=(i=e[key]*s,(t[key]+1)*s),n=this.idx[key]*s,a=r;a<n;a++)this.current.attributes[key].array[i++]=this.current.attributes[key].array[a];for(key in this.idx){var o=t[key]-e[key];this.idx[key]-=o}this.update()},undo:function(e){this.idx=e,this.update()},addBuffer:function(e){var t=new THREE.BufferGeometry,i=new Float32Array(3*this.maxBufferSize),s=new Uint32Array(1.5*this.maxBufferSize),r=new Float32Array(3*this.maxBufferSize),n=new Float32Array(2*this.maxBufferSize),a=new Float32Array(3*this.maxBufferSize),o=new THREE.Mesh(t,this.material);o.frustumCulled=!1,o.vertices=i,this.object3D=new THREE.Object3D;var h=document.querySelector(".a-drawing");if(h||((h=document.createElement("a-entity")).className="a-drawing",document.querySelector("a-scene").appendChild(h)),h.object3D.add(this.object3D),this.object3D.add(o),t.setDrawRange(0,0),t.setAttribute("position",new THREE.BufferAttribute(i,3).setUsage(THREE.DynamicDrawUsage)),t.setIndex(new THREE.BufferAttribute(s,3).setUsage(THREE.DynamicDrawUsage)),t.setAttribute("uv",new THREE.BufferAttribute(n,2).setUsage(THREE.DynamicDrawUsage)),t.setAttribute("normal",new THREE.BufferAttribute(r,3).setUsage(THREE.DynamicDrawUsage)),t.setAttribute("color",new THREE.BufferAttribute(a,3).setUsage(THREE.DynamicDrawUsage)),this.previous=null,this.geometries.length>0&&(this.previous=this.current),this.idx={position:0,uv:0,normal:0,color:0},this.geometries.push(t),this.current=t,this.previous&&e){var u=3*(this.maxBufferSize-2),c=3*(this.maxBufferSize-2),l=(this.maxBufferSize,3*(this.maxBufferSize-2)),d=this.previous.attributes.position.array;this.addVertex(d[u++],d[u++],d[u++]),this.addVertex(d[u++],d[u++],d[u++]);var m=this.previous.attributes.normal.array;this.addNormal(m[l++],m[l++],m[l++]),this.addNormal(m[l++],m[l++],m[l++]);var p=this.previous.attributes.color.array;this.addColor(p[c++],p[c++],p[c++]),this.addColor(p[c++],p[c++],p[c++]);n=this.previous.attributes.uv.array}},addColor:function(e,t,i){this.current.attributes.color.setXYZ(this.idx.color++,e,t,i)},addNormal:function(e,t,i){this.current.attributes.normal.setXYZ(this.idx.normal++,e,t,i)},addVertex:function(e,t,i){var s=this.current.attributes.position;this.idx.position===s.count&&(this.addBuffer(!0),s=this.current.attributes.position),s.setXYZ(this.idx.position++,e,t,i),(this.idx.position+1)%2==0&&this.idx.position>1&&(this.current.index.setXYZ(this.idx.position-3,this.idx.position-3,this.idx.position-2,this.idx.position-1),this.current.index.setXYZ(this.idx.position-2,this.idx.position-1,this.idx.position-2,this.idx.position))},addUV:function(e,t){this.current.attributes.uv.setXY(this.idx.uv++,e,t)},update:function(){this.current.setDrawRange(0,3*this.idx.position),this.current.attributes.color.needsUpdate=!0,this.current.attributes.normal.needsUpdate=!0,this.current.attributes.position.needsUpdate=!0,this.current.attributes.uv.needsUpdate=!0,this.current.index.needsUpdate=!0}},e.exports=t},297:(e,t,i)=>{var s=i(115);function r(){this.sharedBuffers={}}r.prototype={addSharedBuffer:function(e,t){var i=new s(t);this.sharedBuffers[e]=i},getSharedBuffer:function(e){return this.sharedBuffers[e]}},e.exports=new r},796:()=>{var e,t;AFRAME.BRUSHES={},APAINTER_STATS={brushes:{}},AFRAME.registerBrush=function(e,t,i){var s={};if(Object.keys(t).forEach((function(e){s[e]={value:t[e],writable:!0}})),AFRAME.BRUSHES[e])throw new Error("The brush `"+e+"` has been already registered. Check that you are not loading two versions of the same brush or two different brushes of the same name.");var r=function(){};r.prototype={options:Object.assign({spacing:0,maxPoints:0},i),reset:function(){},tick:function(e,t){},undo:function(){},remove:function(){},addPoint:function(e,t,i,s,r){},getJSON:function(e){for(var t=[],i=0;i<this.data.points.length;i++){var s=this.data.points[i];t.push({orientation:Utils.arrayNumbersToFixed(s.orientation.toArray()),position:Utils.arrayNumbersToFixed(s.position.toArray()),pressure:Utils.numberToFixed(s.pressure),timestamp:s.timestamp})}return{brush:{index:e.getUsedBrushes().indexOf(this.brushName),color:Utils.arrayNumbersToFixed(this.data.color.toArray()),size:Utils.numberToFixed(this.data.size)},points:t}},getBinary:function(e){var t=21+36*this.data.points.length,i=new BinaryManager(new ArrayBuffer(t));i.writeUint8(e.getUsedBrushes().indexOf(this.brushName)),i.writeColor(this.data.color),i.writeFloat32(this.data.size),i.writeUint32(this.data.points.length);for(var s=0;s<this.data.points.length;s++){var r=this.data.points[s];i.writeFloat32Array(r.position.toArray()),i.writeFloat32Array(r.orientation.toArray()),i.writeFloat32(r.pressure),i.writeUint32(r.timestamp)}return i.getDataView()}};var n,a,o=function(){};return(o.prototype=Object.create(r.prototype,s)).brushName=e,o.prototype.constructor=o,o.prototype.init=(n=o.prototype.init,function(e,t,i,s){this.object3D=new THREE.Object3D,this.data={points:[],size:t,prevPosition:null,prevPointerPosition:null,numPoints:0,color:e.clone(),timestamp:s,owner:i},n.call(this,e,t)}),o.prototype.addPoint=(a=o.prototype.addPoint,function(e,t,i,s,r){this.data.prevPosition&&this.data.prevPosition.distanceTo(e)<=this.options.spacing||0!==this.options.maxPoints&&this.data.numPoints>=this.options.maxPoints||a.call(this,e,t,i,s,r)&&(this.data.numPoints++,this.data.points.push({position:e.clone(),orientation:t.clone(),pressure:s,timestamp:r}),this.data.prevPosition=e.clone(),this.data.prevPointerPosition=i.clone())}),AFRAME.BRUSHES[e]=o,o.used=!1,o},AFRAME.registerSystem("brush",{schema:{},brushes:{},strokes:[],getUsedBrushes:function(){return Object.keys(AFRAME.BRUSHES).filter((function(e){return AFRAME.BRUSHES[e].used}))},getBrushByName:function(e){return AFRAME.BRUSHES[e]},undo:function(){for(var e,t=this.strokes.length-1;t>=0;t--)if("local"===this.strokes[t].data.owner){e=this.strokes.splice(t,1)[0];break}e&&(e.undo(),document.querySelector(".a-drawing").emit("stroke-removed",{stroke:e}))},removeById:function(e){var t=this.strokes[1];if(console.log(t,this.strokes),t){for(var i=this.strokes.length-1;i>1;i--)if(stroke=this.strokes[i],t.sharedBuffer===stroke.sharedBuffer){for(key in console.log(">>>",stroke.prevIdx,"->",stroke.idx,"target",t.prevIdx,"->",t.idx),t.idx){var s=t.idx[key]-t.prevIdx[key];stroke.idx[key]-=s,stroke.prevIdx[key]-=s}console.log("<<<",stroke.idx,stroke.prevIdx)}this.strokes.splice(1,1)[0].remove()}},clear:function(){for(var e=this.strokes.length-1;e>=0;e--)if("local"===this.strokes[e].data.owner){var t=this.strokes[e];t.undo(),document.querySelector(".a-drawing").emit("stroke-removed",{stroke:t})}Object.keys(AFRAME.BRUSHES).forEach((function(e){AFRAME.BRUSHES[e].used=!1})),this.strokes=[]},init:function(){this.version=1,this.clear(),this.controllerName=null;var e=this;this.sceneEl.addEventListener("controllerconnected",(function(t){e.controllerName=t.detail.name}))},tick:function(e,t){if(this.strokes.length)for(var i=0;i<this.strokes.length;i++)this.strokes[i].tick(e,t)},generateTestLines:function(){var e=Object.keys(AFRAME.BRUSHES);brushesNames2=["leaf1","fur2","star","squared-textured","flat","squared-textured","lines5"];var t=-.6*e.length/2;t=0;e.forEach((function(e){var i=new THREE.Color(Math.random(),Math.random(),Math.random()),s=this.addNewStroke(e,i,.5),r=document.querySelector("#left-hand");r.emit("stroke-started",{entity:r,stroke:s});for(var n=new THREE.Vector3(t,0,-2),a=new THREE.Vector3,o=0;o<4;o++){var h=new THREE.Quaternion;a.set(0,.75,.1);var u=new THREE.Euler(0,Math.PI,0);h.setFromEuler(u),n=n.add(a);var c=this.getPointerPosition(n,h);s.addPoint(n,h,c,1,0)}t+=.6}))},generateRandomStrokes:function(e){function t(){return 2*Math.random()-1}for(var i=document.querySelector("#left-hand"),s=Object.keys(AFRAME.BRUSHES),r=0;r<e;r++){var n=s[parseInt(13*Math.random())],a=new THREE.Color(Math.random(),Math.random(),Math.random()),o=.3*Math.random(),h=parseInt(500*Math.random()),u=this.addNewStroke(n,a,o);i.emit("stroke-started",{entity:i,stroke:u});for(var c=new THREE.Vector3(t(),t(),t()),l=new THREE.Vector3,d=new THREE.Quaternion,m=.2,p=0;p<h;p++){l.set(t(),t(),t()),l.multiplyScalar(t()/20),d.setFromUnitVectors(c.clone().normalize(),l.clone().normalize()),(c=c.add(l)).y<0&&(c.y=-c.y);(m+=1-2*Math.random())<0&&(m=.2),m>1&&(m=1);var f=this.getPointerPosition(c,d);u.addPoint(c,d,f,m,0)}}},addNewStroke:function(e,t,i,s,r){APAINTER_STATS.brushes[e]||(APAINTER_STATS.brushes[e]=0),APAINTER_STATS.brushes[e]++,s=s||"local",r=r||Date.now();var n=this.getBrushByName(e);if(!n){var a=Object.keys(AFRAME.BRUSHES)[0];n=AFRAME.BRUSHES[a],console.warn("Invalid brush name: `"+e+"` using `"+a+"`")}n.used=!0;var o=new n;o.brush=n,o.init(t,i,s,r),this.strokes.push(o);var h=document.querySelector(".a-drawing");return h||((h=document.createElement("a-entity")).className="a-drawing",document.querySelector("a-scene").appendChild(h)),o},getJSON:function(){var e={version:1,strokes:[],author:"",brushes:this.getUsedBrushes()};for(i=0;i<this.strokes.length;i++)e.strokes.push(this.strokes[i].getJSON(this));return e},getBinary:function(){var e=[],t="apainter",i=this.getUsedBrushes(),s=t.length+i.join(" ").length+9,r=new BinaryManager(new ArrayBuffer(s));r.writeString(t),r.writeUint16(1),r.writeUint8(i.length);for(var n=0;n<i.length;n++)r.writeString(i[n]);for(r.writeUint32(this.strokes.length),e.push(r.getDataView()),n=0;n<this.strokes.length;n++)e.push(this.strokes[n].getBinary(this));return e},getPointerPosition:(e=new THREE.Vector3,t={"vive-controls":{vec:new THREE.Vector3(0,.7,1),mult:-.03},"oculus-touch-controls":{vec:new THREE.Vector3(0,0,2.8),mult:-.05},"windows-motion-controls":{vec:new THREE.Vector3(0,0,1),mult:-.12}},function(i,s){if(!this.controllerName)return i;var r=t[this.controllerName],n=r.vec.clone().applyQuaternion(s).normalize().multiplyScalar(r.mult);return e.copy(i).add(n),e}),loadJSON:function(e){1!==e.version&&console.error("Invalid version: ",e.version,"(Expected: 1)"),console.time("JSON Loading");for(var t=0;t<e.strokes.length;t++)for(var i=e.strokes[t],s=i.brush,r=this.addNewStroke(e.brushes[s.index],(new THREE.Color).fromArray(s.color),s.size),n=0;n<i.points.length;n++){var a=i.points[n],o=(new THREE.Vector3).fromArray(a.position),h=(new THREE.Quaternion).fromArray(a.orientation),u=a.pressure,c=a.timestamp,l=this.getPointerPosition(o,h);r.addPoint(o,h,l,u,c)}console.timeEnd("JSON Loading")},loadBinary:function(e){var t=new BinaryManager(e);if("apainter"===t.readString()){var i=t.readUint16();1!==i&&console.error("Invalid version: ",i,"(Expected: 1)"),console.time("Binary Loading");for(var s=t.readUint8(),r=[],n=0;n<s;n++)r.push(t.readString());for(var a=t.readUint32(),o=0;o<a;o++)for(var h=t.readUint8(),u=t.readColor(),c=t.readFloat(),l=t.readUint32(),d=this.addNewStroke(r[h],u,c),m=0;m<l;m++){var p=t.readVector3(),f=t.readQuaternion(),g=t.readFloat(),b=t.readUint32(),v=this.getPointerPosition(p,f);d.addPoint(p,f,v,g,b)}console.timeEnd("Binary Loading")}else console.error("Invalid `magic` header")},loadFromUrl:function(e,t){var i=new THREE.XHRLoader(this.manager);i.crossOrigin="anonymous",!0===t&&i.setResponseType("arraybuffer");var s=this;i.load(e,(function(e){!0===t?s.loadBinary(e):s.loadJSON(JSON.parse(e))}))}})},810:(e,t,i)=>{var s=i(618).saveAs;AFRAME.registerSystem("painter",{init:function(){var e={behaviours:{},mappings:{painting:{common:{"grip.down":"undo","trigger.changed":"paint"},"vive-controls":{axismove:"changeBrushSizeInc","trackpad.touchstart":"startChangeBrushSize","menu.down":"toggleMenu","trackpad.down":"aim","trackpad.up":"teleport"},"oculus-touch-controls":{axismove:"changeBrushSizeAbs","abutton.down":"toggleMenu","xbutton.down":"toggleMenu","ybutton.down":"aim","ybutton.up":"teleport","bbutton.down":"aim","bbutton.up":"teleport"},"windows-motion-controls":{axismove:"changeBrushSizeAbs","menu.down":"toggleMenu","trackpad.down":"aim","trackpad.up":"teleport"}}}};this.sceneEl.addEventListener("loaded",(function(){AFRAME.registerInputMappings(e),AFRAME.currentInputMapping="painting"})),this.version="1.2",this.brushSystem=this.sceneEl.systems.brush,this.showTemplateItems=!0;var t=function(){var e,t=/\+/g,i=/([^&=]+)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(t," "))},r=window.location.search.substring(1),n={};for(e=i.exec(r);e;)n[s(e[1])]=s(e[2]),e=i.exec(r);return n}();if(t.url||t.urljson){var i=void 0===t.urljson;this.brushSystem.loadFromUrl(t.url||t.urljson,i),document.getElementById("logo").setAttribute("visible",!1),document.getElementById("acamera").setAttribute("orbit-controls","position","0 1.6 3"),document.getElementById("apainter-logo").classList.remove("hidden")}void 0!==t.bgcolor&&(document.body.style.backgroundColor="#"+t.bgcolor),void 0!==t.sky&&this.sceneEl.addEventListener("loaded",(function(e){""===t.sky?document.getElementById("sky").setAttribute("visible",!1):document.getElementById("sky").setAttribute("material","src",t.sky)})),void 0!==t.floor&&this.sceneEl.addEventListener("loaded",(function(e){""===t.floor?document.getElementById("ground").setAttribute("visible",!1):document.getElementById("ground").setAttribute("material","src",t.floor)})),this.logoFade=null,this.logoFading=!1,this.time=0;var s=this;document.addEventListener("stroke-started",(function(e){if(!s.logoFading){var t=document.getElementById("logo"),i=t.getObject3D("mesh"),r={alpha:1};s.logoFade=AFRAME.ANIME({targets:r,alpha:0,duration:4e3,update:function(){i.children[0].material.opacity=r.alpha},complete:function(){t.setAttribute("visible",!1),s.logoFading=!1}}),s.logoFade.play(),s.logoFading=!0}})),document.addEventListener("keyup",(function(e){if(!e.shiftKey&&!e.ctrlKey){if(8===e.keyCode&&s.brushSystem.undo(),67===e.keyCode&&s.brushSystem.clear(),71===e.keyCode){var t=document.querySelector(".a-drawing");s.sceneEl.systems["gltf-exporter"].export(t)}if(78===e.keyCode){var i=document.querySelectorAll("[paint-controls]"),r=Object.keys(AFRAME.BRUSHES),n=r.indexOf(i[0].components.brush.data.brush);n=(n+1)%r.length,[].forEach.call(i,(function(e){e.setAttribute("brush","brush",r[n])}))}if(84===e.keyCode&&s.brushSystem.generateTestLines(),82===e.keyCode&&s.brushSystem.generateRandomStrokes(1),76===e.keyCode&&s.brushSystem.loadFromUrl("demo.apa",!0),85===e.keyCode&&s.upload(),86===e.keyCode&&s.save(),74===e.keyCode&&s.saveJSON(),79===e.keyCode){s.showTemplateItems=!s.showTemplateItems;for(var a=document.querySelectorAll(".templateitem"),o=0;o<a.length;o++)a[o].setAttribute("visible",s.showTemplateItems)}88===e.keyCode&&s.brushSystem.removeById(2)}})),console.info("A-PAINTER Version: "+this.version)},tick:function(e,t){this.logoFading&&(this.time+=t,this.logoFade.tick(this.time))},saveJSON:function(){var e=this.brushSystem.getJSON(),t=new Blob([JSON.stringify(e)],{type:"application/json"});s(t,"demo.json")},save:function(){var e=this.brushSystem.getBinary(),t=new Blob(e,{type:"application/octet-binary"});s(t,"demo.apa")},upload:function(e,t){this.sceneEl.emit("drawing-upload-started");var i=this,s="https://aframe.io/a-painter/?url=",r=this.brushSystem.getBinary(),n=new Blob(r,{type:"application/octet-binary"});uploadcare.fileFrom("object",n).done((function(t){console.log("Uploaded link: ",s+t.cdnUrl),i.sceneEl.emit("drawing-upload-completed",{url:s+t.cdnUrl}),e&&e()})).fail((function(e,s){i.sceneEl.emit("drawing-upload-error",{errorInfo:e,fileInfo:s}),t&&t(e)})).progress((function(e){i.sceneEl.emit("drawing-upload-progress",{progress:e.progress})}))}})},493:()=>{AFRAME.registerSystem("ui",{init:function(){this.initTextures()},initTextures:function(){var e=this,t="assets/images/ui-hover.png",i="assets/images/ui-pressed.png";this.sceneEl.systems.material.loadTexture(t,{src:t},(function(t){e.hoverTexture=t})),this.sceneEl.systems.material.loadTexture(i,{src:i},(function(t){e.pressedTexture=t}))},closeAll:function(){var e,t=document.querySelectorAll("[ui]");for(e=0;e<t.length;e++)t[e].components.ui.close()}})},369:()=>{window.addEventListener("load",(function(e){var t=document.getElementById("apainter-ui"),i=document.querySelector("#apainter-ui .share"),s=document.getElementById("apainter-share-url"),r=document.querySelector("#apainter-ui .progress"),n=document.querySelector("#apainter-ui .bar");document.addEventListener("drawing-upload-completed",(function(e){i.classList.remove("hide"),r.classList.add("hide"),s.value=e.detail.url})),document.addEventListener("drawing-upload-started",(function(e){t.style.display="block",i.classList.add("hide"),r.classList.remove("hide")})),document.addEventListener("drawing-upload-progress",(function(e){n.style.width=Math.floor(100*e.detail.progress)+"%"})),new Clipboard(".button.copy").on("error",(function(e){console.error("Error copying to clipboard:",e.action,e.trigger)}))}))},555:()=>{window.Utils=function(){function e(e){return parseFloat(e.toFixed(6))}return{numberToFixed:e,arrayNumbersToFixed:function(t){for(var i=0;i<t.length;i++)t[i]=e(t[i]);return t},getTooltips:function(e){var t;switch(e){case"windows-motion-samsung-controls":t=".windows-motion-samsung-tooltips";break;case"windows-motion-controls":t=".windows-motion-tooltips";break;case"oculus-touch-controls":t=".oculus-tooltips";break;case"vive-controls":t=".vive-tooltips"}return Array.prototype.slice.call(document.querySelectorAll(t))}}}()},192:()=>{!function(){const e={type:"change"},t={type:"start"},i={type:"end"};class s extends THREE.EventDispatcher{constructor(s,r){super(),void 0===r&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=s,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",W),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(e),n.update(),o=a.NONE},this.update=function(){const t=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(s.up,new THREE.Vector3(0,1,0)),r=i.clone().invert(),p=new THREE.Vector3,f=new THREE.Quaternion,g=2*Math.PI;return function(){const s=n.object.position;t.copy(s).sub(n.target),t.applyQuaternion(i),u.setFromVector3(t),n.autoRotate&&o===a.NONE&&R(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(u.theta+=c.theta*n.dampingFactor,u.phi+=c.phi*n.dampingFactor):(u.theta+=c.theta,u.phi+=c.phi);let b=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(b)&&isFinite(v)&&(b<-Math.PI?b+=g:b>Math.PI&&(b-=g),v<-Math.PI?v+=g:v>Math.PI&&(v-=g),u.theta=b<=v?Math.max(b,Math.min(v,u.theta)):u.theta>(b+v)/2?Math.max(b,u.theta):Math.min(v,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=l,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),t.setFromSpherical(u),t.applyQuaternion(r),s.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),l=1,!!(m||p.distanceToSquared(n.object.position)>h||8*(1-f.dot(n.object.quaternion))>h)&&(n.dispatchEvent(e),p.copy(n.object.position),f.copy(n.object.quaternion),m=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",J),n.domElement.removeEventListener("pointerdown",N),n.domElement.removeEventListener("pointercancel",Y),n.domElement.removeEventListener("wheel",q),n.domElement.removeEventListener("pointermove",V),n.domElement.removeEventListener("pointerup",D),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",W)};const n=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=a.NONE;const h=1e-6,u=new THREE.Spherical,c=new THREE.Spherical;let l=1;const d=new THREE.Vector3;let m=!1;const p=new THREE.Vector2,f=new THREE.Vector2,g=new THREE.Vector2,b=new THREE.Vector2,v=new THREE.Vector2,E=new THREE.Vector2,y=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,S=[],T={};function A(){return Math.pow(.95,n.zoomSpeed)}function R(e){c.theta-=e}function M(e){c.phi-=e}const O=function(){const e=new THREE.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),d.add(e)}}(),j=function(){const e=new THREE.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),H=function(){const e=new THREE.Vector3;return function(t,i){const s=n.domElement;if(n.object.isPerspectiveCamera){const r=n.object.position;e.copy(r).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),O(2*t*a/s.clientHeight,n.object.matrix),j(2*i*a/s.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(O(t*(n.object.right-n.object.left)/n.object.zoom/s.clientWidth,n.object.matrix),j(i*(n.object.top-n.object.bottom)/n.object.zoom/s.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function B(e){n.object.isPerspectiveCamera?l/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function k(e){n.object.isPerspectiveCamera?l*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function z(e){p.set(e.clientX,e.clientY)}function P(e){b.set(e.clientX,e.clientY)}function C(){if(1===S.length)p.set(S[0].pageX,S[0].pageY);else{const e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);p.set(e,t)}}function _(){if(1===S.length)b.set(S[0].pageX,S[0].pageY);else{const e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);b.set(e,t)}}function L(){const e=S[0].pageX-S[1].pageX,t=S[0].pageY-S[1].pageY,i=Math.sqrt(e*e+t*t);y.set(0,i)}function U(e){if(1==S.length)f.set(e.pageX,e.pageY);else{const t=Q(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);f.set(i,s)}g.subVectors(f,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;R(2*Math.PI*g.x/t.clientHeight),M(2*Math.PI*g.y/t.clientHeight),p.copy(f)}function I(e){if(1===S.length)v.set(e.pageX,e.pageY);else{const t=Q(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);v.set(i,s)}E.subVectors(v,b).multiplyScalar(n.panSpeed),H(E.x,E.y),b.copy(v)}function F(e){const t=Q(e),i=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(i*i+s*s);w.set(0,r),x.set(0,Math.pow(w.y/y.y,n.zoomSpeed)),B(x.y),y.copy(w)}function N(e){!1!==n.enabled&&(0===S.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",V),n.domElement.addEventListener("pointerup",D)),function(e){S.push(e)}(e),"touch"===e.pointerType?function(e){switch(Z(e),S.length){case 1:switch(n.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===n.enableRotate)return;C(),o=a.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===n.enablePan)return;_(),o=a.TOUCH_PAN;break;default:o=a.NONE}break;case 2:switch(n.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&L(),n.enablePan&&_(),o=a.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&L(),n.enableRotate&&C(),o=a.TOUCH_DOLLY_ROTATE;break;default:o=a.NONE}break;default:o=a.NONE}o!==a.NONE&&n.dispatchEvent(t)}(e):function(e){let i;switch(e.button){case 0:i=n.mouseButtons.LEFT;break;case 1:i=n.mouseButtons.MIDDLE;break;case 2:i=n.mouseButtons.RIGHT;break;default:i=-1}switch(i){case THREE.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY)}(e),o=a.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;P(e),o=a.PAN}else{if(!1===n.enableRotate)return;z(e),o=a.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;z(e),o=a.ROTATE}else{if(!1===n.enablePan)return;P(e),o=a.PAN}break;default:o=a.NONE}o!==a.NONE&&n.dispatchEvent(t)}(e))}function V(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(Z(e),o){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;U(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;I(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&F(e),n.enablePan&&I(e)}(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&F(e),n.enableRotate&&U(e)}(e),n.update();break;default:o=a.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case a.ROTATE:if(!1===n.enableRotate)return;!function(e){f.set(e.clientX,e.clientY),g.subVectors(f,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;R(2*Math.PI*g.x/t.clientHeight),M(2*Math.PI*g.y/t.clientHeight),p.copy(f),n.update()}(e);break;case a.DOLLY:if(!1===n.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),x.subVectors(w,y),x.y>0?B(A()):x.y<0&&k(A()),y.copy(w),n.update()}(e);break;case a.PAN:if(!1===n.enablePan)return;!function(e){v.set(e.clientX,e.clientY),E.subVectors(v,b).multiplyScalar(n.panSpeed),H(E.x,E.y),b.copy(v),n.update()}(e)}}(e))}function D(e){X(e),0===S.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",V),n.domElement.removeEventListener("pointerup",D)),n.dispatchEvent(i),o=a.NONE}function Y(e){X(e)}function q(e){!1!==n.enabled&&!1!==n.enableZoom&&o===a.NONE&&(e.preventDefault(),n.dispatchEvent(t),function(e){e.deltaY<0?k(A()):e.deltaY>0&&B(A()),n.update()}(e),n.dispatchEvent(i))}function W(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:H(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:H(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:H(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:H(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function J(e){!1!==n.enabled&&e.preventDefault()}function X(e){delete T[e.pointerId];for(let t=0;t<S.length;t++)if(S[t].pointerId==e.pointerId)return void S.splice(t,1)}function Z(e){let t=T[e.pointerId];void 0===t&&(t=new THREE.Vector2,T[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){const t=e.pointerId===S[0].pointerId?S[1]:S[0];return T[t.pointerId]}n.domElement.addEventListener("contextmenu",J),n.domElement.addEventListener("pointerdown",N),n.domElement.addEventListener("pointercancel",Y),n.domElement.addEventListener("wheel",q,{passive:!1}),this.update()}}THREE.MapControls=class extends s{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE}},THREE.OrbitControls=s}()},618:function(e,t,i){var s,r=r||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,i=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in s,n=/constructor/i.test(e.HTMLElement),a=/CriOS\/[\d]+/.test(navigator.userAgent),o=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},h=function(e){setTimeout((function(){"string"==typeof e?i().revokeObjectURL(e):e.remove()}),4e4)},u=function(e,t,i){for(var s=(t=[].concat(t)).length;s--;){var r=e["on"+t[s]];if("function"==typeof r)try{r.call(e,i||e)}catch(e){o(e)}}},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(t,o,l){l||(t=c(t));var d,m=this,p="application/octet-stream"===t.type,f=function(){u(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,r)return d=i().createObjectURL(t),void setTimeout((function(){s.href=d,s.download=o,function(e){var t=new MouseEvent("click");e.dispatchEvent(t)}(s),f(),h(d),m.readyState=m.DONE}));!function(){if((a||p&&n)&&e.FileReader){var s=new FileReader;return s.onloadend=function(){var t=a?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,m.readyState=m.DONE,f()},s.readAsDataURL(t),void(m.readyState=m.INIT)}(d||(d=i().createObjectURL(t)),p)?e.location.href=d:e.open(d,"_blank")||(e.location.href=d);m.readyState=m.DONE,f(),h(d)}()},d=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(e,t,i){return new l(e,t||e.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */e.exports?e.exports.saveAs=r:null!==i.amdD&&null!==i.amdO&&(void 0===(s=function(){return r}.apply(t,[]))||(e.exports=s))},95:e=>{"use strict";e.exports=JSON.parse('{"meta":{"image":"brush_atlas.png","size":{"w":3584,"h":2944},"scale":"1"},"frames":{"stamp_grass.png":{"frame":{"x":0,"y":128,"w":1536,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1536,"h":512},"sourceSize":{"w":1536,"h":512}},"lines4.png":{"frame":{"x":0,"y":0,"w":2048,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":2048,"h":128},"sourceSize":{"w":2048,"h":128}},"stamp_fur2.png":{"frame":{"x":0,"y":640,"w":1536,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1536,"h":512},"sourceSize":{"w":1536,"h":512}},"stamp_bush.png":{"frame":{"x":0,"y":1152,"w":1024,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":512},"sourceSize":{"w":1024,"h":512}},"stamp_gear.png":{"frame":{"x":1024,"y":1152,"w":1024,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":512},"sourceSize":{"w":1024,"h":512}},"stamp_fur1.png":{"frame":{"x":2048,"y":0,"w":1024,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":512},"sourceSize":{"w":1024,"h":512}},"lines3.png":{"frame":{"x":2048,"y":512,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_gradient.png":{"frame":{"x":2048,"y":768,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"lines5.png":{"frame":{"x":2048,"y":1024,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"silky_flat.png":{"frame":{"x":2048,"y":1280,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"silky_textured.png":{"frame":{"x":0,"y":1664,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"squared_textured.png":{"frame":{"x":1024,"y":1664,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_grunge2.png":{"frame":{"x":2048,"y":1664,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_grunge3.png":{"frame":{"x":0,"y":1920,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_grunge1.png":{"frame":{"x":1024,"y":1920,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"lines2.png":{"frame":{"x":2048,"y":1920,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"stamp_leaf3.png":{"frame":{"x":1536,"y":128,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_dots.png":{"frame":{"x":1536,"y":640,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"thumb_stamp_star.png":{"frame":{"x":2304,"y":1536,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"stamp_grunge1.png":{"frame":{"x":512,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge2.png":{"frame":{"x":1024,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge3.png":{"frame":{"x":1536,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge4.png":{"frame":{"x":2048,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge5.png":{"frame":{"x":2560,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_leaf1.png":{"frame":{"x":3072,"y":0,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_leaf2.png":{"frame":{"x":3072,"y":512,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_column.png":{"frame":{"x":3072,"y":1024,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_snow.png":{"frame":{"x":3072,"y":1536,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_squares.png":{"frame":{"x":3072,"y":2048,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"lines1.png":{"frame":{"x":0,"y":2688,"w":256,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":256,"h":256},"sourceSize":{"w":256,"h":256}},"thumb_rainbow.png":{"frame":{"x":3072,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_single_sphere.png":{"frame":{"x":3200,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_fur1.png":{"frame":{"x":3328,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_fur2.png":{"frame":{"x":3456,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_grass.png":{"frame":{"x":2048,"y":1536,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_snow.png":{"frame":{"x":2176,"y":1536,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"stamp_star.png":{"frame":{"x":0,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}}}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.amdD=function(){throw new Error("define cannot be used indirect")},s.amdO={},window.saveAs=s(618).saveAs,s(453),s(821),s(967),s(192),s(297),s(115),s(555),s(369),s(796),s(493),s(810),s(620),s(116),s(510),s(174),s(101),s(688),s(579),s(295),s(623),s(988),s(830),s(775),s(891)})();